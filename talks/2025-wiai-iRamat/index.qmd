---
title: "iRamat, un package R"
subtitle: "**WIAI** - **W**ebinaires de l'**I**nformatique pour l'**A**rch√©om√©trie √† l'**I**RAMAT"
author:
  - name: Thomas Huet
    affiliation: 
      - id: cnrs
        name: <span style="font-size:17pt">IRAMAT-CNRS</span>
title-slide-attributes:
    data-background-image: "https://raw.githubusercontent.com/iramat/iramat-dev/master/img/ana-xrf-pymca-ex.png"
    data-background-size: "90%"
    data-background-opacity: "0.2"
    data-notes: Lorem
format:
  revealjs: 
    css: https://zoometh.github.io/thomashuet/css/quarto.css
    controls: true
    auto-stretch: false
    code-fold: false
    code-summary: "<small>Code</small>"
    slide-number: true
    chalkboard:
      theme: "whiteboard"
      color: ['rgba(255, 0, 0, 0.3)'] # red
    scrollable: true
    preview-links: auto
    reference-location: document
    footnotes-hover: true
    # self-contained: true
    # embed-resources: true
    # logo: https://raw.githubusercontent.com/zoometh/neonet/master/doc/img/neonet.png
    footer: "Thomas Huet - <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/inst-cnrs-iramat.png' style='height: 17px;vertical-align: middle;'> - 7 Octobre, 2025, CEB, Orl√©ans"
    margin: 0
    width: 1200
---

# Introduction g√©n√©rale


## La s√©rie WIAI

:::: {.columns}
::: {.column width="65%"}

Webinaires d√©di√©s aux technologies de l'information pour l'arch√©om√©trie:  <br>
GitHub <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-github.png' style='height: 45px;vertical-align: middle;'>, Python
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-prg-python-2.png' style='height: 45px;vertical-align: middle;'>, R
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/prog-r-1.png' style='height: 45px;vertical-align: middle;'>, API 
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/web-api.jpeg' style='height: 45px;vertical-align: middle;'>, IIIF
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/lod-iso-iiif.png' style='height: 45px;vertical-align: middle;'>, etc. <br><br>

::: {.callout-note}
üìÖ Le 2<sup>e</sup> Mardi matin de chaque mois sur ZOOM entre 10h00 et 10h50 (50 minutes), lien sur le [GitHub de l'IRAMAT](https://github.com/iramat#-wiai)
:::

:::

::: {.column width="35%"}

<center>

![](https://upload.wikimedia.org/wikipedia/commons/7/76/Jim_Gray_Computing_in_the_21st_Century_2006.jpg){width="300" style="vertical-align: middle;"}
</center>
<div class="captiontext"> _"A data structure is nothing without an algorithm, and an algorithm is nothing without a data structure."_ -- Jim Gray ¬© Microsoft Research, CC BY-SA </div>


:::

:::

::: {.notes}
D√©couvrir -- ou approfondir -- une solution logicielle open-source en revenant sur l'histoire de ce logiciel, sa logique interne, ... Avec des citations rigolotes
:::



## Plan de la pr√©sentation


1. <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/prog-r-1.png' style='height: 45px;vertical-align: middle;'> et les _packages_
2. Composition d‚Äôun _package_ <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/prog-r-1.png' style='height: 45px;vertical-align: middle;'> ( <img src='https://raw.githubusercontent.com/iramat/iRamat/master/doc/img/logo.png' style='height: 60px;vertical-align: middle;'> )
3. Du `code` √† la <math><mi>f</mi></math>, et de la <math><mi>f</mi></math> au `{pkg}` ( <img src='https://raw.githubusercontent.com/iramat/iRamat/master/doc/img/logo.png' style='height: 60px;vertical-align: middle;'> )
5. _Code as data_
6. Discussion


# R et les _packages_



## {}


:::: {.columns}

::: {.column width="70%"}
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/prog-r-1.png' style='height: 50px;vertical-align: middle;'> est un langage de script orient√© statistiques. C'est le langage pr√©f√©r√©s des arch√©ologues[^1] qui utilisent des _packages_ g√©n√©riques comme `ggplot` <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-ggplot.png' style='width: 50px;vertical-align: middle;'> pour les graphiques (d√©velopp√© par Hadley Wickham), `terra` <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-terra.png' style='width: 50px;vertical-align: middle;'> et `sf` <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-sf.png' style='width: 50px;vertical-align: middle;'> pour l'analyse spatiale, etc., ou d'autres plus sp√©cialis√©s: `nexus` <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-nexus.png' style='width: 50px;vertical-align: middle;'>, `tidyspec` <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg-tidyspec.png' style='width: 50px;vertical-align: middle;'>, etc.


[^1]:  Batist, Z. and Roe, J. 2024 Open Archaeology, Open Source? Collaborative practices in an emerging community of archaeological software engineers, _Internet Archaeology_ 67. <https://doi.org/10.11141/ia.67.13>

:::

::: {.column width="30%"}

![](https://upload.wikimedia.org/wikipedia/commons/f/fa/Hadley-wickham2016-02-04.jpg){width="300" style="vertical-align: middle;"}
<div class="captiontext">_"Anything that can be automated, should be automated"_ -- Hadley Wickham, 2023 <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/lod-licences-publicdomain-1.png' style='height: 12px;vertical-align: middle;'> Wikipedia </div>
:::

::::



## Les _packages_ R

:::: {.columns}

::: {.column width="50%"}

- rassemblent du code, de la documentation et parfois des donn√©es.<br>

- con√ßus pour √™tre facilement partag√©, install√© et r√©utilis√© et ainsi garantir la reproductibilit√© des analyses.

- <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/lod-data-fair.png' style='width: 350px;vertical-align: middle;'>
:::

::: {.column width="50%"}

```{=html}
<div style="width:1000px; height:450px; overflow:hidden;">
  <iframe src="https://cran.r-project.org/"
          style="transform: scale(0.9); transform-origin: 0 0; width:750px; height:500px; border:none;">
  </iframe>
</div>
```
<div class="captiontext">Le _Comprehensive R Archive Network_ (CRAN) <https://cran.r-project.org/>, l'archive officielle des _packages_ R </div>
:::

::::



## Les _packages_ R (suite)

:::: {.columns}

::: {.column width="60%"}
- En 2023, 19,000+ packages heberg√©s sur le CRAN. 

- En 2021, 25,000+ packages heberg√©s sur GitHub[^2]
:::

::: {.column width="40%"}
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkgs-mosaic-3.png' style='width: 600px;vertical-align: middle;'>
:::

::::

[^2]: Bommarito, E., & Bommarito II, M. J. (2021). An empirical analysis of the R package ecosystem. _arXiv preprint arXiv:2102.09904_.

## Trouver un package <img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkgs-mosaic-4.png' style='width: 80px;vertical-align: middle;'>

::: {.panel-tabset}

### `{pkgsearch}`

```{r echo=TRUE}
# install.packages("pkgsearch")
library(pkgsearch)
ps("raman")
```

### R-Universe

<small><https://r-universe.dev/search?q=raman></small>
```{=html}
<iframe width="1200" height="500" src="https://r-universe.dev/search?q=raman" title="Search for Raman"></iframe>
```


### GitHub

<small><https://github.com/search/advanced></small>
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg--search-github.png' style='width: 1000px;vertical-align: middle;'><br><center>‚¨áÔ∏è</center><br>
<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg--search-github-1.png' style='width: 1000px;vertical-align: middle;'>

### open-archaeo

[open-archaeo](https://open-archaeo.info/) et le [SIG-SSLA](https://sslarch.github.io/)

```{=html}
<iframe width="1200" height="500" src="https://open-archaeo.info/tags/x-ray-fluorescence/" title="Search for Raman"></iframe>
```
<small>https://open-archaeo.info/tags/x-ray-fluorescence/</small>

:::


# Composition d‚Äôun _package_ R


## Description (fichiers sources)


::: {.panel-tabset}

### `DESCRIPTION`

Le fichier [`DESCRIPTION`](https://github.com/iramat/iRamat/blob/main/DESCRIPTION) contient les m√©tadonn√©es du _package_

```{.md code-line-numbers="1|3|4|6|9|12-22|28|29"}
Package: iRamat
Type: Package
Title: Statistical analysis on Archaeomaterial
Description: Statistical analysis on Archaeomaterial.
Version: 1.0.0
Authors@R: c(person("Thomas", "Huet", email = "thomas.huet@cnrs.fr", role = c("aut", "cre"), comment=c(ORCID="0000-0002-1112-6122")))
Depends:
    R (>= 4.0.1)
License: MIT + file LICENSE
Encoding: UTF-8
LazyData: true
Imports:
    dplyr,
    ggplot2,
    forcats,
    stringr,
    hash,
    jsonlite,
    httr,
    imager,
    spatstat.geom,
    spatstat.explore   
RoxygenNote: 7.3.2
Suggests: 
    testthat (>= 3.0.0),
    ggpubr
Config/testthat/edition: 3
URL: https://github.com/iramat/iRamat
BugsReport: https://github.com/iramat/iRamat/issues
```

<br><br>

### `LICENSE`

Les fichiers [`LICENSE`](https://github.com/iramat/iRamat/blob/main/LICENSE) et [`LICENSE.md`](https://github.com/iramat/iRamat/blob/main/LICENSE.md) contiennent la licence du _package_

:::: {.columns}

::: {.column width="40%"}

[`LICENSE`](https://github.com/iramat/iRamat/blob/main/LICENSE)
```{.md}
YEAR: 2025
COPYRIGHT HOLDER: IRAMAT-CNRS
```

:::

::: {.column width="60%"}

[`LICENSE.md`](https://github.com/iramat/iRamat/blob/main/LICENSE.md)
```{.md}
# MIT License

Copyright (c) 2025 IRAMAT-CNRS

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

(...)
```

:::

::::

### `README.md`

Le fichier [`README.md`](https://github.com/iramat/iRamat?tab=readme-ov-file) pr√©sente le _package_

<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg--readme-github.png' style='width: 1000px;vertical-align: middle;'>


### `R/`

Le dossier [`R/`](https://github.com/iramat/iRamat/tree/main/R) contient les fonctions R

```{.r code-line-numbers="1|3|4|6-9|11|13-16|18|19-26" code-overflow="wrap"}
#' Connect the CHIPS DB API and return an R object (dataframe, etc.)
#'
#' @name db_api_connect
#' @description Connect the CHIPS DB API and return an R object (dataframe, etc.). The default dataset is dataset_adisser17, accessed at <http://157.136.252.188:3000/dataset_adisser17>
#'
#' @param d A hash object. If none is provided, a new one will be created.
#' @param api_url An URL landing to an API. Default: 'dataset_adisser17'.
#' @param output_format The selected output format. Default "dataframe".
#' @param verbose if TRUE (by default), verbose.
#'
#' @return An R object.
#'
#' @examples
#' df <- db_api_connect()
#' # Show the first rows of the dataframe
#' head(df$dataset_adisser17)
#' 
#' @export
db_api_connect <- function(d = NA,
                           api_url = "http://157.136.252.188:3000/dataset_adisser17",
                           output_format = "dataframe",
                           verbose = TRUE){
                           
                           (...)
                           
                           }
```

<br><br>

### `inst/extdata/`

Le dossier [`inst/extdata/`](https://github.com/iramat/iRamat/tree/main/inst/extdata/) contient les donn√©es externes


:::: {.columns}

::: {.column width="33%"}
<small>regular_distribution.png</small>
<center>
<img src='https://raw.githubusercontent.com/iramat/iRamat/master/inst/extdata/regular_distribution.png' style='width: 220px;vertical-align: middle;'>
</center>
:::

::: {.column width="33%"}
<small>clustered_distribution.png</small>
<center>
<img src='https://raw.githubusercontent.com/iramat/iRamat/master/inst/extdata/clustered_distribution.png' style='width: 220px;vertical-align: middle;'>
</center>
:::

::: {.column width="33%"}
<small>random_distribution.png</small>
<center>
<img src='https://raw.githubusercontent.com/iramat/iRamat/master/inst/extdata/random_distribution.png' style='width: 220px;vertical-align: middle;'>
</center>
:::

::::

:::


## Description (fichiers g√©n√©r√©s)

::: {.panel-tabset}

### `NAMESPACE`

Le fichier [`NAMESPACE`](https://github.com/iramat/iRamat/tree/main/NAMESPACE) d√©crit quelles fonctions du _package_ sont export√©es.

```{.r-doc code-line-numbers="1|3-5"}
# Generated by roxygen2: do not edit by hand

export(chrono)
export(db_api_connect)
export(ppa)
```

### `man/`

Le dossier [`man/`](https://github.com/iramat/iRamat/tree/main/man) contient la documentation des fonctions (g√©n√©r√©e depuis les fonctions elles-m√™mes).

```{.r-doc code-line-numbers="1-2"}
% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ppa.R
\name{ppa}
\alias{ppa}
\title{Classify a Point Pattern Distribution}
\usage{
ppa(
  d = NA,
  root = "https://raw.githubusercontent.com/iramat/iRamat/master/inst/extdata/",
  img.paths = c("clustered_distribution.png", "random_distribution.png",
    "regular_distribution.png"),
  ppa_tests = c("quadrat", "ripley", "gfunction"),
  verbose = TRUE
)
}
(...)
```

:::

# Du code √† la fonction, et de la fonction au package


## Du `code` √† la <math><mi>f</mi></math>, et de la <math><mi>f</mi></math> au `{pkg}`


::: {.panel-tabset}

### Au Km

```{.r}
# Generate 100 random numbers from a normal distribution
x <- rnorm(100, mean = 10, sd = 2)

# Compute the mean
mean_x <- mean(x)

# Print the result
cat("The mean of x is:", mean_x, "\n")
```



### Fonctions

```{.r}
#' Compute the mean of random normal numbers
#'
#' This function generates `n` random numbers from a normal distribution
#' with given `mean` and `sd`, then computes and prints their mean.
#'
#' @param n Integer, number of random values to generate.
#' @param mean Numeric, the mean of the normal distribution.
#' @param sd Numeric, the standard deviation of the normal distribution.
#'
#' @return The computed mean (numeric).
#' @export
#'
#' @examples
#' simulate_mean(100, mean = 10, sd = 2)
simulate_mean <- function(n = 100, mean = 0, sd = 1) {
  x <- rnorm(n, mean = mean, sd = sd)
  mean_x <- mean(x)
  cat("The mean of x is:", mean_x, "\n")
  return(mean_x)
}
```

<br><br>

### Package (_private_)

<small><https://github.com/iramat/iramat-private></small>

<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg--repo-private-github.png' style='width: 1000px;vertical-align: middle;'>

### Package (_public_)

<small><https://github.com/iramat/iRamat></small>

<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg--repo-public-github.png' style='width: 1000px;vertical-align: middle;'>


:::

# _Code as data_


## R√©utiliser

::: {.panel-tabset}

### Citer

```{r echo=TRUE}
citation("iRamat")
```

<br><br>

### Publier sur Zenodo

<small><https://docs.github.com/en/repositories/archiving-a-github-repository/referencing-and-citing-content></small>

<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/app-zenodo-github-release.png' style='width: 900px;vertical-align: middle;'>

### Publier dans une revue

<small><https://joss.theoj.org/papers/10.21105/joss.03191></small>

<img src='https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg--repo-public-publish-github.png' style='width: 900px;vertical-align: middle;'>

:::

# Discussion {background-image="https://raw.githubusercontent.com/zoometh/thomashuet/master/img/r-pkg--repo-public-github.png" background-opacity=0.5 background-size="800px" background-repeat="repeat"}

